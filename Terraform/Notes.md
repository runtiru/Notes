# Terraform Providers

    - Terraform uses providers to interact with the cloud vendors to create resources.
    - Terraform providers are written in `Go language`, and it maintained by HashiCorp (human-readable configuration language) and the community.
    - Terraform relies on plugins called "Providers" to interact with cloud provider.

* How to create aws provider..?
  - Create a new file called `main.tf` in your terraform project directory.

## Provider's Example

## Configure the AWS Provider

```sh
terraform {
  required_providers {
    aws = {
      source = "hashicorp/aws"
      version = "5.61.0"
    }
  }
}

provider "aws" {
  # Configuration options
}
```

## Configure the Microsoft Azure Provider

```sh
terraform {
  required_providers {
    azurerm = {
      source = "hashicorp/azurerm"
      version = "3.114.0"
    }
  }
}

provider "azurerm" {
  # Configuration options
}
```

## Configure the GCP

```sh
terraform {
  required_providers {
    google = {
      source = "hashicorp/google"
      version = "5.39.1"
    }
  }
}

provider "google" {
  # Configuration options
}
```

Creste one folder 'providers' inside the provider 'main.tf'

* main.tf

```sh
terraform {
  required_providers {
    aws = {
      source = "hashicorp/aws"
      version = "5.61.0"
    }
  }
}

provider "aws" {
  # Configuration options
}
```

Before initialization trace level log setup in the terraform
```sh
export TF_LOG_TRACE (It will print all logs of console)
terraform init
ls -a
```

When you run `terraform init`, Terraform generates a `.terraform.lock.hcl` and `.terraform` files.

## .terraform.lock.hcl

  1. A lock file `.terraform.lock.hcl` to store the information about the dependencies required by your Terraform configuration..
  2. `Dependency Locking` a lock file that containes information about the dependencies requierd by your configuration.
  This includes:
      Povider versions
      Module versions
      Other dependencies
  3. The `.terraform.lock.hcl` file is written in HCL (HashiCorp Configuration Language) format, which is a human-readable configuration language.

```sh
# This is a generated file. Do not edit.

dependency "aws" {
  version = "3.27.0"
}

dependency "null" {
  version = "3.1.0"
}

module "example" {
  source  = "hashicorp/example/aws"
  version = "1.2.3"
}
```

  1. `Don't edit the file manually`: The lock file is generated by Terraform, and editing it manually can lead to inconsistencies and errors.
  2. `Commit the file to version control`: Include the .terraform.lock.hcl file in your version control system to ensure that all team members are using the same dependencies.
  3. Use `terraform init to update the file`: If you need to update the lock file, run terraform init to regenerate it.

## .terraform

  1. A Directory it contains a variety of files and subdirectories that are used by Terraform to manage your infrastructure deployments.

```sh
.terraform/
├── environment (environment-specific files - environment variables)
├── modules     (Each module used in your Terraform configuration)
├── plugins     (Plugin binaries)
├── providers   (Provider binaries)
├── terraform.tfstate (Current state of your infrastructure deployment)
├── terraform.tfstate.backup (Backup of the previous state of your infrastructure deployment.)
└── versions.tf (version information for Terraform and its dependencies.)
```

## Terraform state file

  The Terraform state file is used to store the current state of your infrastructure deployment. It contains information about the resources that have been created, updated, or deleted.
  The state file is used by Terraform to determine what actions to take when you run terraform apply or terraform destroy.

* terraform.tfstate

  1. This file is used to store the current state of your infrastructure deployment, which includes Resource IDs, Resource attributes, Resource relationships.
  2. It serves as a database that stores the current state of your infrastructure, which is used to manage and provision resources on cloud and on-premises environments.
  3. The file is written in JSON format and is used by Terraform to keep track of the resources it has created or modified.
  4. The file is updated every time you run `terraform apply` or `terraform refresh`.

* Stored in terraform.tfstate
  1. `Resource metadata`: Details about the resources created by Terraform, such as their IDs, names, and properties.
  2. `Resource dependencies`: Information about the relationships between resources, like which resources depend on others.
  3. `Provider configuration`: Settings for the providers used by Terraform, like AWS, Azure, or Google Cloud.

* Why terraform.tfstate file
  1. `Infrastructure management`: Terraform uses the state file to keep track of the resources it has created, updated, or deleted.
  2. `Change detection`: When you run terraform apply, Terraform compares the current state with the desired state (defined in your configuration files) to determine what changes need to be made.
  3. `Resource deletion`: When you delete a resource from your configuration, Terraform uses the state file to identify the resource and delete it from the infrastructure.

* How to manage terraform.tfstate file
  1. `Store it securely`: Keep the state file in a secure location, such as an encrypted S3 bucket or a secrets manager like HashiCorp's Vault.
  2. `Use a remote state`: Store the state file remotely, using a service like Terraform Cloud or AWS S3, to enable collaboration and version control.
  3. `Backup and version`: Regularly backup and version your state file to prevent data loss and track changes.

* Security Considerations
  1. `Sensitive Data`: The state file may contain sensitive information such as (passwords, keys, and other secrets). It is crucial to manage access to the terraform.tfstate file carefully and use appropriate security measures.
  2. `Version Control`: It is generally not recommended to store the state file in version control due to its sensitive nature and the potential for conflicts when multiple team members work on the same infrastructure.
  
* Common Commands
  1. `Inspect State`: You can inspect the state using terraform state commands, such as `terraform state list` to list resources and `terraform state show <resource>` to show detailed information about a specific resource.
  2. `Move Resources`: Use `terraform state mv` to move resources within the state file.
  3. `Remove Resources`: Use `terraform state rm` to remove resources from the state file without deleting the actual resources.

* Best Practices
  1. `Remote State Storage`: Use remote state backends for collaboration and to ensure state consistency.
  2. `State Locking`: Enable state locking when using remote state to prevent concurrent modifications.
  3. `Security`: Restrict access to the state file and use encryption for remote state storage.
  4. `Backup`: Regularly back up your state file to prevent data loss.

```sh
# Configure the Terraform Cloud provider
provider "terraform" {
  cloud {
    organization = "your-organization"
    workspaces {
      name = "your-workspace"
    }
  }
}

# Store the state file in Terraform Cloud
terraform {
  backend "remote" {
    organization = "your-organization"
    workspaces {
      name = "your-workspace"
    }
  }
}
```

## Terraform state backup file..?

  A file is a backup of the `terraform.tfstate file`, automatically created by Terraform to ensure that you have a recovery point in case the current state file becomes corrupted or lost.

* `terraform.tfstate.backup` file
  1. `Disaster Recovery`: In the event of a disaster, such as a disk failure or accidental deletion, a backup of the state file ensures that you can recover your Terraform configuration and continue managing your infrastructure.
  2. `Version Control`: If you're using a version control system like Git, backing up the state file allows you to track changes to your infrastructure over time and roll back to a previous version if needed.
  3. `Collaboration`: When working in a team, backing up the state file ensures that all team members have access to the same infrastructure configuration, reducing the risk of conflicts and inconsistencies.

* Purpose
  1. `Safety Net`:- The primary purpose of the `terraform.tfstate.backup file` is to provide a fallback option. If something goes wrong with the terraform.tfstate file, you can revert to the backup.
  2. `Automatic Creation`:- Terraform automatically creates this backup whenever the terraform.tfstate file is updated. This ensures that you always have a recent backup of the state file.

* File Management
  1. `Location`:- By default, the backup file is stored in the same directory as the terraform.tfstate file. It is named terraform.tfstate.backup.
  2. `Remote Backends`:- When using remote state backends, the backup management might differ slightly. Some remote backends manage state versions and backups internally, providing mechanisms to revert to previous state versions.
  3. `Restoring from Backup`:- If you need to restore the state from the backup, you can manually replace the corrupted terraform.tfstate file with the terraform.tfstate.backup file by renaming it.
Command line example:
```sh
mv terraform.tfstate.backup terraform.tfstate
```

* Best Practices
  1. `Regular Backups`:- Although Terraform provides automatic backups, it is good practice to create additional backups of your state files, especially before making significant changes.
  2. `Version Control`:- Avoid storing state files in version control systems due to their sensitive nature. Instead, use secure and automated backup solutions.
  3. `State Locking`:- Use state locking features provided by remote backends to prevent concurrent operations that could lead to state file corruption.
  4. `Security`:- Ensure that access to state files (including backups) is restricted to authorized personnel only, as they may contain sensitive information.
  5. `Testing Recovery`:- Periodically test the recovery process using backup files to ensure you can quickly restore your infrastructure state if needed.

* How to Backup terraform state file
  1. `Manual Backup`:- Manually copy the terraform.tfstate file to a safe location, such as a cloud storage service or an external hard drive.
  2. `Automated Backup`:- Use a tool like `cron` to schedule regular backups of the terraform.tfstate file to a secure location.
  3. `Remote Backends`:- If using a remote backend, check the backend's documentation for information on how to manage state backups and versions.
  4. `Terraform's Built-in Backup`:- Terraform provides a built-in backup mechanism using the terraform state pull command. This command retrieves the current state from the remote state store and saves it to a local file.

  hwois